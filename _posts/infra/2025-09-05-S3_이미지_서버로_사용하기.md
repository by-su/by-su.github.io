---
title: S3를 이미지 서버로 사용해보자
excerpt: AWS S3를 사용해 블로그 이미지를 효율적으로 관리하고 최적화하는 방법을 소개합니다. S3 버킷 생성부터 IAM 사용자 권한 설정, 옵시디언(Obsidian) 연동까지 단계별로 쉽게 따라할 수 있습니다.
permalink: S3-이미지-서버-사용하기
categories: [Infra]
tags: [aws, 클라우드, 이미지호스팅, 옵시디언]
image:
  path: /assets/covers/infra.png
toc: true
---

## 비용
https://aws.amazon.com/ko/s3/pricing/ 

https://calculator.aws/#/createCalculator/S3
- 사진 평균 1MB, POST 1000건, 읽기 3000건으로 가정 한 달 비용 0.36USD로 측정되었습니다.

## S3 버킷 생성
### 이름 생성하기
![image](https://rootbly-images.s3.ap-northeast-2.amazonaws.com/notes/c274162f4999b7b50a1f69cc72e9dbd5.png)

- s3 bucket 이름을 생성합니다. 사용하고 싶은 이름을 사용하면 되지만 "." 은 사용하지 마세요.. SSL인증을 못하게 됩니다. (본인 경험입니다)

### ACL 설정
![image](https://rootbly-images.s3.ap-northeast-2.amazonaws.com/notes/5f6ac1321dc4603d51bbfb0ab2e39c90.png)
- ACL를 사용할 것인지 물어보는 건데요. 최근 AWS에서는 ACL 대신 버킷 정책과 IAM 정책을 더 권장하고 있습니다. 당연히 `disabled` 합니다.

번외: ACL(Access Control List)이란 ?
S3 버킷과 객체에 대한 액세스 권한을 관리하는 리소스 기반 권한 제어 방식으로 특정 AWS 계정 혹은 그룹에 대해 읽기, 쓰기 권한 등을 부여하여 버킷과 객체에 대한 접근을 제어할 수 있는 기능입니다. ACL방식은 제한적이고 관리가 복잡하기 때문에 IAM 정책을 이용한 더 세밀하고 유연한 권한 관리를 권장하고 있습니다.

### 접근 범위 설정
![image](https://rootbly-images.s3.ap-northeast-2.amazonaws.com/notes/13efd1042f15e3531868f78032cb2613.png)
- 접근 범위를 설정하는 것으로 블로그를 위한 이미지를 올리기 때문에 일단 모두 허용합니다.

### 암호화 선택
![image](https://rootbly-images.s3.ap-northeast-2.amazonaws.com/notes/5af96b8eaab444f4220bb66dd2f2e02c.png)

- **SSE-S3**: 운영 및 관리가 쉽고, 추가 비용 없이 AWS에서 자동으로 암호화해주므로 일반적인 퍼블릭/블로그 이미지 용도에 가장 적합합니다.
- **SSE-KMS**: 중요한 업무 데이터, 개인정보 등 더 엄격한 키 관리와 액세스 통제가 필요한 경우에 선택하며, AWS KMS의 추가 비용(API 호출당 비용+KMS 키 관리 비용)이 발생합니다.
- **DSSE-KMS**: 정부, 금융, 국방 등 규제 준수를 위해 이중 암호화가 요구되는 특수한 경우만 선택합니다. 비용 역시 SSE-KMS보다 더 높으며, 일반 사용자에게는 과도한 옵션입니다.

일반적인 블로그 용도로 `SSE-S3` 선택하고 넘어갑니다.


## Permissions 추가하기
- 읽기만 허용해줍니다.
```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "PublicReadGetObject",
            "Effect": "Allow",
            "Principal": "*",
            "Action": "s3:GetObject",
            "Resource": "arn:aws:s3:::{{버킷 이름}}/*"
        }
    ]
}
```


## IAM 자격증명 만들기

### 정책 생성하기
`IAM` > `Access Management`탭에서 `Policies` > Create policy 선택합니다.

![image](https://rootbly-images.s3.ap-northeast-2.amazonaws.com/notes/7221e9e839e01f3bd8a698ded8065db8.png)
- 기본적으로 Visual로 선택되어 있는데 Json을 선택하고 다음 Json을 입력해줍니다.

```
{
	"Version": "2012-10-17",
	"Statement": [
		{
			"Sid": "AllowPutObjectOnly",
			"Effect": "Allow",
			"Action": [
				"s3:PutObject",
				"s3:GetObject"
			],
			"Resource": "arn:aws:s3:::{{s3_버킷_이름}}/*"
		}
	]
}
```
- 읽기와 쓰기 권한을 부여한 정책을 생성하는 과정입니다.


### IAM 사용자 생성하기
`IAM` > `Access Management`탭에서 Users > Create User 선택합니다.

![image](https://rootbly-images.s3.ap-northeast-2.amazonaws.com/notes/cff9ee8460604fe3f04e9cddd082af0f.png)
- Attach policies directly를 선택하고 아까 만든 policy이름을 검색합니다.
- 저는 S3WritePolicy라고 이름 지었고 이를 선택해서 사용자와 정책을 연결해주겠습니다.

### Access Token 발급받기
![image](https://rootbly-images.s3.ap-northeast-2.amazonaws.com/notes/ed231d2218bbae0f005f4eb756aaf348.png)
- API 등에서 사용할 키를 발급해주세요.

## 옵시디언 연결하기
`Obsidian` > `settings` > `community plugins` > `S3 Image Uploader` 설치

![image](https://rootbly-images.s3.ap-northeast-2.amazonaws.com/notes/7705f6e492549e6fa8aa5112bebcb88d.png)
- 발급 받은 액세스 키, 시크릿 키를 입력해줍니다.
- 서울 기준으로 Region은 `ap-northeast-2` 를 일력해줍니다.
- S3 Bucket과 Bucket folder는 생성한 이름과 폴더를 입력해줍니다.


이제 드래그 앤 드랍하면 이미지가 S3로 연동되고 자동으로 이미지도 연동됩니다.
![image](https://rootbly-images.s3.ap-northeast-2.amazonaws.com/notes/1dac8c6e36e9b01282668c4e36d7a260.png)

