---
title: Route53 이용해 DR 세팅하기
excerpt: Route53을 이용해 DR(Disaster Recovery) 세팅하는 방법에 대해 알아봅니다.
permalink: Route53-DR(백업)-세팅하기
categories: [Infra]
tags: [aws, 클라우드, DR, 백업서버, 가용성, Route53, DNS, 네임서버]
image:
  path: /assets/covers/dr_preview.png
toc: true
---

## Route53 세팅하기
### Hosted zone 생성하기
`Route53` > `Get started`
![image](https://rootbly-images.s3.ap-northeast-2.amazonaws.com/notes/536dace841e640967690286384b8733d.png)
- `Created hosted zones` 로 시작합니다.

| 메뉴                          | 설명                                    |
| --------------------------- | ------------------------------------- |
| **Register a domain**       | AWS에서 새로운 도메인을 구매/등록할 때 사용            |
| **Transfer domain**         | 기존 등록기관(Namecheap 등)에서 AWS로 도메인을 이전   |
| **Create hosted zones**     | 보유 중인 도메인을 Route 53에 연결하고 레코드 관리      |
| **Configure health checks** | Route 53이 서버 상태를 모니터링하고 장애 시 failover |
| **Configure traffic flow**  | 다중 리전, 가중치 기반, 지리적 분산 등 복잡한 라우팅       |
| **Configure resolvers**     | VPC 내부 DNS 쿼리 처리용                     |


![image](https://rootbly-images.s3.ap-northeast-2.amazonaws.com/notes/ff6eff64495d41906b6201bb63e1fb81.png)
사용하는 도메인 이름을 적어줍니다.<br/><br/>


![image](https://rootbly-images.s3.ap-northeast-2.amazonaws.com/notes/fb99689908b8b0e142447c221972a130.png)
Route53을 생성하면 다음과 같이 기본 Records가 생성되어있음을 확인할 수 있습니다.
- NS(Name Server): rootbly.com 도메인을 담당하는 Route53 네임서버 목록입니다.
- SOA(Start of Authority): DNS의 **최종 책임지점과 동작 규칙**을 지정하는 기본 메타데이터
  왜 필요할까요? 다음과 같이 같은 도메인 규칙을 가진 네임서버가 서로 다른 API를 가리킨다고 가정해보겠습니다.
  ```
    ns1 서버: a.rootbly.com -> 0.0.0.1 
    ns2 서버: a.rootbly.com -> 0.0.0.2
  ```
  어디로 접속해야 할지 알 수 없습니다. SOA는 ns1 네임서버가 이 도메인의 최종 결정권자라는 것을 정해줍니다.

<br/>

### 네임 서버 교체하기
저는 도메인을 Namecheap에서 샀기 때문에 기본적으로 Namecheap DNS가 도메인을 관리하는데요, 이제 Route53에서 레코드를 관리할거기 때문에 Namecheap 쪽 네임 서버를 AWS Route 53이 준 네임서버로 교체해야합니다.


![image](https://rootbly-images.s3.ap-northeast-2.amazonaws.com/notes/e9fb668df4c1476a1934b5c12ee5c761.png)
Namecheap에서 NS를 새로 등록해주었습니다.<br/><br/>


![image](https://rootbly-images.s3.ap-northeast-2.amazonaws.com/notes/0ee5018bc0abe575b3fcb376050c077f.png)
`dig {{ 도메인 }}` 을 통해 네임서버로 등록되었는지 확인해보겠습니다. <br/><br/>

![image](https://rootbly-images.s3.ap-northeast-2.amazonaws.com/notes/cd6cd2473048ce0c5bceb246fe58408c.png)
잘 등록되었네요. 이제 Namecheap에서 사용하던 A레코드도 Route53에 등록합니다. <br/><br/>



### 헬스체크 생성하기
`Route53` > `Health checks` > `Create helath check`

![image](https://rootbly-images.s3.ap-northeast-2.amazonaws.com/notes/5f0bebff7824da2c3b05a5a791c5c4f8.png)

이제 이 헬스체크를 이용해 Failover를 세팅해보겠습니다.<br/><br/>


![image](https://rootbly-images.s3.ap-northeast-2.amazonaws.com/notes/848a56f1755258586f9b4131442c7f32.png)
- 위에서 생성한 A레코드의 Routing policy를 A레코드에서 Failover로 바꾼 뒤 Primary로 선택해주겠습니다.
- health check는 바로 위에서 생성한 헬스체크를 선택합니다.
- Record ID는 Record를 식별하기 위한 값으로 프로젝트-primary, 또는 프로젝트-secondary로 지정해주겠습니다.


![image](https://rootbly-images.s3.ap-northeast-2.amazonaws.com/notes/acb6b0d01cf3d0c4b421d2d9bdc686ec.png)
이제 DR을 위한 Secondary 레코드도 생성해주겠습니다.<br/><br/>


이제 메인 서버를 죽이고 메인 서버가 죽었을 때 DR서버로 요청이 가는지 확인하겠습니다.

![image](https://rootbly-images.s3.ap-northeast-2.amazonaws.com/notes/56580f251d0725631d2e7e06e523a873.png)
헬스체크가 다운되었습니다.<br/><br/>

![image](https://rootbly-images.s3.ap-northeast-2.amazonaws.com/notes/2cfd2e405ae10524d1f10260a03c6513.png)
DNS가 바뀐 것을 확인할 수 있습니다. 이제 요청이 DR서버로 갑니다. <br/>

## 마치며
온프레미스 서버가 자꾸 말썽을 부려서 결국 DR 서버까지 세팅하게 됐습니다. 아직 유저가 많진 않지만, 들어온 사람이 끊기지 않고 쓸 수 있다는 게 훨씬 마음이 편하네요. 

